<!-- parent_portal/home.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}Ù„ÙˆØ­Ø© ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø±{% endblock %}

{% block extra_head %}
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --muted: #64748b;
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --ring: #e2e8f0;
      --chip: #eef2ff;
      --chip-border: #c7d2fe;
      --ok: #16a34a;
      --warn: #ca8a04;
      --danger: #dc2626;
      --ok-bg: #dcfce7;
      --warn-bg: #fef9c3;
      --danger-bg: #fee2e2;
      --shadow: 0 4px 20px rgba(0,0,0,0.08);
      --radius: 16px;
    }
    
    * {
      box-sizing: border-box;
      transition: all 0.2s ease;
    }
    
    html, body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Tahoma, Arial, system-ui;
    }
    
    a {
      color: inherit;
      text-decoration: none;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    /* Dashboard Header */
    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
      position: relative;
    }
    
    .dashboard-header::after {
      content: "";
      position: absolute;
      bottom: -12px;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(to right, var(--primary), transparent);
      opacity: 0.3;
    }
    
    .title {
      font-size: 28px;
      margin: 0;
      background: linear-gradient(45deg, var(--primary), #818cf8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      box-shadow: var(--shadow);
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(79, 70, 229, 0.2);
    }
    
    .btn--ghost {
      background: #fff;
      color: var(--primary);
      border: 1px solid var(--chip-border);
    }
    
    .btn--ghost:hover {
      background: #f7f9ff;
      border-color: var(--primary);
    }
    
    .btn--sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    /* Section card */
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      border: 1px solid rgba(0,0,0,0.03);
    }
    
    .card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--ring);
    }
    
    .card__title {
      margin: 0;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card__title-icon {
      background: var(--chip);
      width: 32px;
      height: 32px;
      display: grid;
      place-items: center;
      border-radius: 8px;
      color: var(--primary);
    }

    /* Children grid */
    .children {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
      gap: 24px;
    }

    /* Child card */
    .child {
      border: 1px solid var(--ring);
      border-radius: var(--radius);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .child:hover {
      box-shadow: var(--shadow);
      border-color: var(--chip-border);
    }
    
    .child::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(to right, var(--primary), #818cf8);
    }
    
    .child__head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .meta {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--chip);
      border: 2px solid var(--chip-border);
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: 18px;
      color: var(--primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .name {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 4px;
    }
    
    .muted {
      color: var(--muted);
      font-size: 14px;
    }

    /* Actions row */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 4px;
    }
    
    .action-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-top: 8px;
      border-top: 1px dashed var(--ring);
    }
    
    .action-group__title {
      font-size: 14px;
      font-weight: 600;
      color: var(--muted);
      margin: 0;
    }

    /* SCQ strip */
    .scq-strip {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      background: #f8fafc;
      padding: 12px;
      border-radius: 10px;
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .pill--yes {
      background: var(--ok-bg);
      color: var(--ok);
    }
    
    .pill--no {
      background: var(--danger-bg);
      color: var(--danger);
    }
    
    .pill--pending {
      background: var(--warn-bg);
      color: var(--warn);
    }

    /* Sessions chips */
    .sessions-container {
      background: #f8fafc;
      padding: 12px;
      border-radius: 10px;
    }
    
    .sessions-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .sessions-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--muted);
      margin: 0;
    }
    
    .chips {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 12px;
      background: var(--chip);
      border: 1px solid var(--chip-border);
      color: #1e2a78;
      transition: all 0.2s ease;
    }
    
    .chip:hover {
      background: #e8edff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      font-weight: 600;
    }
    
    .badge--completed {
      background: var(--ok-bg);
      color: var(--ok);
    }
    
    .badge--active {
      background: var(--warn-bg);
      color: var(--warn);
    }
    
    .badge--aborted {
      background: var(--danger-bg);
      color: var(--danger);
    }
    
    .chip--outline {
      background: #fff;
      color: #3243a3;
      border-style: dashed;
    }
    
    .chip--outline:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .empty {
      color: var(--muted);
      padding: 20px;
      text-align: center;
      background: #f8fafc;
      border-radius: 10px;
      border: 1px dashed var(--ring);
    }
    
    .empty-icon {
      font-size: 24px;
      margin-bottom: 8px;
      opacity: 0.5;
    }
    
    @media (max-width: 768px) {
      .wrapper {
        padding: 16px;
      }
      
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .children {
        grid-template-columns: 1fr;
      }
      
      .child__head {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
{% endblock %}

{% block content %}
  <div class="wrapper">

    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h1 class="title">Ù…Ø±Ø­Ø¨Ù‹Ø§ {{ request.user.username }} â€” Ù„ÙˆØ­Ø© ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø±</h1>
      <a class="btn" href="{% url 'parent_portal:create_child' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Ø£Ø¶Ù Ø·ÙÙ„ Ø¬Ø¯ÙŠØ¯
      </a>
    </div>

    <!-- Children Section -->
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">
          <span class="card__title-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
          Ø£Ø·ÙØ§Ù„ÙŠ
        </h2>
      </div>

      {% if children %}
        <div class="children">
          {% for c in children %}
            <div class="child">

              <!-- Child Card Header: Name + Specialist -->
              <div class="child__head">
                <div class="meta">
                  <div class="avatar">{{ c.username|slice:":1" }}</div>
                  <div>
                    <div class="name">{{ c.username }}</div>

                    {% if c.specialist %}
                      <div class="muted">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;margin-inline-end:4px">
                          <path d="M20 7h-3a2 2 0 0 0-2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h3"></path>
                          <path d="M12 2h4v4h-4z"></path>
                          <path d="M12 22V7"></path>
                          <path d="M16 2l-4 4-4-4"></path>
                        </svg>
                        Ø£Ø®ØµØ§Ø¦ÙŠ: {{ c.specialist.username }}
                      </div>

                    {% elif c.pending_link %}
                      <div class="muted">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;margin-inline-end:4px">
                          <circle cx="12" cy="12" r="10"></circle>
                          <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰:
                        <strong>{{ c.pending_link.specialist.username }}</strong>
                        <span class="pill pill--pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                      </div>

                    {% else %}
                      <div class="muted">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;margin-inline-end:4px">
                          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                          <circle cx="9" cy="7" r="4"></circle>
                          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Ø£Ø®ØµØ§Ø¦ÙŠ: ØºÙŠØ± Ù…Ø­Ø¯Ø¯
                        <a class="btn btn--ghost btn--sm" style="margin-inline-start:8px"
                           href="{% url 'parent_portal:assign_specialist' c.id %}">
                          ØªØ¹ÙŠÙŠÙ† Ø£Ø®ØµØ§Ø¦ÙŠ
                        </a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="action-group">
                <h4 class="action-group__title">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h4>
                <div class="actions">
                  <a class="btn btn--ghost" href="{% url 'child_skills_overview' c.id %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                      <line x1="16" y1="13" x2="8" y2="13"></line>
                      <line x1="16" y1="17" x2="8" y2="17"></line>
                      <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø¢Ø®Ø± Ø¬Ù„Ø³Ø©
                  </a>
                  <a class="btn btn--ghost" href="{% url 'parent_portal:parent_scq_form' c.id %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                      <path d="M9 14l2 2 4-4"></path>
                    </svg>
                    Ø§Ø³ØªØ¨ÙŠØ§Ù† ÙˆÙ„ÙŠÙ‘ Ø§Ù„Ø£Ù…Ø± (SCQ)
                  </a>
                  <a class="btn btn--ghost"
                    href="{% url 'parent_portal:parent_ai_coach' c.id %}{% if c.last_completed_session %}?session_id={{ c.last_completed_session.id }}{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                      <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ
                  </a>
                </div>
              </div>

              <!-- SCQ Survey Results -->
              {% if c.latest_scq %}
                <div class="scq-strip">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                  </svg>
                  <span>Ø¢Ø®Ø± Ø§Ø³ØªØ¨ÙŠØ§Ù†: {{ c.latest_scq.created_at|date:"Y-m-d" }}</span>
                  <span class="pill pill--yes">Ù†Ø¹Ù…: {{ c.latest_scq.yes_count }}</span>
                  <span class="pill pill--no">Ù„Ø§: {{ c.latest_scq.no_count }}</span>
                  <a class="btn btn--ghost btn--sm" href="{% url 'parent_portal:parent_scq_result' c.id c.latest_scq.id %}">ÙØªØ­ Ø¢Ø®Ø± Ø§Ø³ØªØ¨ÙŠØ§Ù†</a>
                </div>
              {% endif %}

              <!-- Child Sessions -->
              {% with sessions=c.assessment_sessions.all %}
                {% if sessions %}
                  <div class="sessions-container">
                    <div class="sessions-header">
                      <h4 class="sessions-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:inline-block;vertical-align:middle;margin-inline-end:4px">
                          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                          <line x1="16" y1="2" x2="16" y2="6"></line>
                          <line x1="8" y1="2" x2="8" y2="6"></line>
                          <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø·ÙÙ„
                      </h4>
                    </div>
                    <div class="chips" aria-label="Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø·ÙÙ„">
                      {% for s in sessions %}
                        <a class="chip" href="{% url 'child_skills_overview' c.id %}?session_id={{ s.id }}">
                          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                          </svg>
                          Ø¬Ù„Ø³Ø© {{ s.started_at|date:"Y-m-d" }}
                          {% if s.ended_at %} â€” {{ s.ended_at|date:"H:i" }}{% endif %}
                          <span class="badge {% if s.status == 'completed' %}badge--completed{% elif s.status == 'active' %}badge--active{% else %}badge--aborted{% endif %}">
                            {{ s.get_status_display }}
                          </span>
                          <span class="badge badge--completed">
                            {{ s.duration_human }}
                          </span>
                        </a>
                      {% endfor %}
                      <a class="chip chip--outline" href="{% url 'child_skills_overview' c.id %}?session_id=all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <line x1="8" y1="6" x2="21" y2="6"></line>
                          <line x1="8" y1="12" x2="21" y2="12"></line>
                          <line x1="8" y1="18" x2="21" y2="18"></line>
                          <line x1="3" y1="6" x2="3.01" y2="6"></line>
                          <line x1="3" y1="12" x2="3.01" y2="12"></line>
                          <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
                      </a>
                    </div>
                  </div>
                {% else %}
                  <div class="empty">
                    <div class="empty-icon">ğŸ“Š</div>
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ø¨Ø¹Ø¯.
                  </div>
                {% endif %}
              {% endwith %}

            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty">
          <div class="empty-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
          Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø·ÙØ§Ù„ Ù…Ø¶Ø§ÙÙˆÙ† Ø¨Ø¹Ø¯.
          <div style="margin-top:12px">
            <a class="btn btn--ghost" href="{% url 'parent_portal:create_child' %}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14M5 12h14"/>
              </svg>
              Ø£Ø¶Ù Ø·ÙÙ„ Ø¬Ø¯ÙŠØ¯
            </a>
          </div>
        </div>
      {% endif %}
    </div>

  </div>
{% endblock %}
